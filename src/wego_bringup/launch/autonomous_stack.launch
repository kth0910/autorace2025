<?xml version="1.0"?>
<launch>
  <!-- ========================================== -->
  <!-- WeGO Autonomous Driving Stack Launch File -->
  <!-- ========================================== -->
  <!-- 
    전체 자율주행 시스템을 실행합니다.
    VISION → PLANNING → CONTROL 파이프라인
  -->

  <!-- Arguments -->
  <arg name="rviz" default="false" doc="RViz 시각화 실행 여부"/>
  <arg name="use_camera" default="true" doc="USB 카메라 실행 여부"/>
  <arg name="simulation" default="false" doc="시뮬레이션 모드 (더미 데이터 사용)"/>
  <arg name="use_vesc_feedback" default="false" doc="VESC 피드백 사용 (false면 명령값 사용)"/>

  <!-- ========================================== -->
  <!-- 0. ODOMETRY (센서 융합)                    -->
  <!-- ========================================== -->
  <include file="$(find wego_bringup)/launch/odometry.launch">
    <arg name="simulation" value="$(arg simulation)"/>
    <arg name="use_vesc_feedback" value="$(arg use_vesc_feedback)"/>
    <arg name="rate" value="50.0"/>
  </include>

  <!-- ========================================== -->
  <!-- 1. VISION Pipeline                         -->
  <!-- ========================================== -->
  <group ns="vision">
    <include file="$(find wego_vision)/launch/vision_pipeline.launch">
      <arg name="start_camera" value="$(arg use_camera)"/>
      <arg name="rviz" value="false"/>
    </include>
  </group>

  <!-- ========================================== -->
  <!-- 2. PLANNING Pipeline                       -->
  <!-- ========================================== -->
  <group ns="planning">
    <include file="$(find wego_planning)/launch/planner.launch">
      <arg name="rviz" value="false"/>
    </include>
  </group>

  <!-- ========================================== -->
  <!-- 3. CONTROL Pipeline                        -->
  <!-- ========================================== -->
  <group ns="control">
    <include file="$(find wego_control)/launch/control.launch">
      <arg name="rviz" value="false"/>
    </include>
  </group>

  <!-- ========================================== -->
  <!-- Visualization (RViz)                       -->
  <!-- ========================================== -->
  <group if="$(arg rviz)">
    <node name="rviz" pkg="rviz" type="rviz" 
          args="-d $(find wego_bringup)/config/wego_autonomous.rviz" 
          output="screen"/>
  </group>

  <!-- ========================================== -->
  <!-- Static TF: base_link -> sensors            -->
  <!-- ========================================== -->
  <!-- base_link를 중심으로 센서들의 위치 정의 -->
  <node pkg="tf" type="static_transform_publisher" name="base_link_to_camera" 
        args="0.15 0 0.1 0 0 0 base_link camera_link 100"/>
  <node pkg="tf" type="static_transform_publisher" name="base_link_to_imu" 
        args="0 0 0.05 0 0 0 base_link imu_link 100"/>
  <node pkg="tf" type="static_transform_publisher" name="base_link_to_laser" 
        args="0.1 0 0.15 0 0 0 base_link laser_link 100"/>

  <!-- ========================================== -->
  <!-- Logging                                    -->
  <!-- ========================================== -->
  <node name="logger" pkg="rospy_tutorials" type="talker" output="screen" unless="$(arg simulation)"/>

  <!-- ========================================== -->
  <!-- System Monitor (Optional)                  -->
  <!-- ========================================== -->
  <!-- <include file="$(find wego_bringup)/launch/system_monitor.launch"/> -->

</launch>

